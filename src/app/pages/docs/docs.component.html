<div class="docs-page">
  <!-- Barra superior -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-box">
        <span class="logo-letter">E</span>
      </div>
      <div class="logo-text">
        <span class="name">Efact</span>
        <span class="subtitle">WEB Â· Comprobantes</span>
      </div>
    </div>

    <div class="topbar-right">
      <div class="user-info">
        <span class="label">Usuario:</span>
        <span class="value">{{ auth.currentUser }}</span>
      </div>
      <button class="btn btn-danger" (click)="logout()">
        Cerrar sesiÃ³n
      </button>
    </div>
  </header>

  <!-- SubmenÃº -->
  <nav class="subnav">
    <button class="tab tab-active">Documento</button>
    <button class="tab" disabled>Crear</button>
    <button class="tab" disabled>Convertir a Factura Negociable</button>
  </nav>

  <!-- Contenido principal -->
  <main class="content">
    <!-- Panel lateral -->
    <aside class="side-card">
      <h2>InformaciÃ³n</h2>

      <div class="field">
        <div class="label">Ticket</div>
        <div class="ticket-box">
          <span class="ticket-value">{{ ticket }}</span>
          <button type="button" class="ticket-copy" (click)="copyTicket()">
            Copiar
          </button>
        </div>
      </div>

      <div class="field">
        <div class="label">Estado</div>
        <div class="status-pill">
          <span class="status-dot"></span>
          Listo para visualizar
        </div>
      </div>

      <p class="hint">
        Selecciona <strong>PDF</strong>, <strong>XML</strong> o
        <strong>CDR</strong> para mostrar el comprobante.
      </p>

      <div class="buttons-group">
        <button
          class="btn btn-doc pdf"
          [class.active]="activeView === 'pdf'"
          (click)="loadPdf()"
          [disabled]="loadingPdf"
        >
          PDF
        </button>

        <button
          class="btn btn-doc xml"
          [class.active]="activeView === 'xml'"
          (click)="loadXml()"
          [disabled]="loadingXml"
        >
          XML
        </button>

        <button
          class="btn btn-doc cdr"
          [class.active]="activeView === 'cdr'"
          (click)="loadCdr()"
          [disabled]="loadingCdr"
        >
          CDR
        </button>
      </div>
    </aside>

    <!-- Visor -->
    <section class="viewer-card">
      <header class="viewer-header">
        <h2>VisualizaciÃ³n de comprobante</h2>
        <span class="viewer-badge" *ngIf="activeView">
          {{ activeView.toUpperCase() }}
        </span>
      </header>

      <div class="viewer-body">
        <!-- âœ… Loader SOLO para la vista activa -->
        <div
          class="state state-loading"
          *ngIf="
            (activeView === 'pdf' && loadingPdf) ||
            (activeView === 'xml' && loadingXml) ||
            (activeView === 'cdr' && loadingCdr)
          "
        >
          <div class="spinner"></div>
          <p>Cargando documento...</p>
        </div>

        <!-- Sin selecciÃ³n -->
        <div
          class="state state-empty"
          *ngIf="!activeView && !error"
        >
          <div class="empty-icon">ðŸ“„</div>
          <h3>No hay documento seleccionado</h3>
          <p>
            Usa los botones <strong>PDF</strong>, <strong>XML</strong> o
            <strong>CDR</strong> del panel izquierdo para visualizar el
            comprobante electrÃ³nico.
          </p>
        </div>

        <!-- âœ… PDF (corregido) -->
        <div
          class="state state-viewer"
          *ngIf="activeView === 'pdf' && pdfUrl"
        >
          <iframe
            class="pdf-frame"
            [src]="pdfUrl"
            title="Comprobante PDF"
            (load)="onPdfLoaded()"
          ></iframe>
        </div>

        <!-- XML -->
        <pre
          class="code-view"
          *ngIf="activeView === 'xml' && xml && !loadingXml"
        >{{ xml }}</pre>

        <!-- CDR -->
        <pre
          class="code-view"
          *ngIf="activeView === 'cdr' && cdr && !loadingCdr"
        >{{ cdr }}</pre>

        <!-- Error -->
        <p class="error-view" *ngIf="error">
          {{ error }}
        </p>
      </div>
    </section>
  </main>
</div>
